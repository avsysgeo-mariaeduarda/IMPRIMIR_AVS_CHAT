<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IMPRIMIR</title>
</head>
<body>

<script src="https://fileschat.sfo2.cdn.digitaloceanspaces.com/public/libs/wlclient.js"></script>

<script>
  function getParam(name) {
    try { return new URL(window.location.href).searchParams.get(name); }
    catch (_) { return null; }
  }

  function renderModal() {
    document.body.innerHTML = `
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 0;
      }

      .container {
        padding: 12px 16px;
        height: 100vh;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 12px;         
      }

      .actions {
        display: flex;
        gap: 8px;        
      }

      button {
        padding: 6px 14px;      
        background-color: #192d3e; 
        color: #ffffff;            
        border: none;             
        border-radius: 4px;             
        font-size: 13px;
      }

      .content {
        flex: 1;                   
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .box {
        display: none;
      }

     .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      input {
        padding: 6px;
        width: 110px;
        box-sizing: border-box;
      }

      .msg {
        margin-top: 6px;
        color: #b00020;
        font-size: 12px;
        min-height: 14px;
      }
      .footer {
        display: flex;
        gap: 8px;
        padding-top: 8px;
      }
    </style>

    <div class="container">
    <div class="actions">
      <button id="btn-hoje" type="button">HOJE</button>
      <button id="btn-anteriores" type="button">DIAS ANTERIORES</button>
    </div>

    <div class="content">
      <div id="box-hoje" class="box">
        <p>Será impresso o histórico de hoje.</p>
      </div>

      <div id="box-data" class="box">
        <div class="field">
          <div>INSIRA DIA ESCOLHIDO (DD/MM/AA)</div>
          <input id="inp-data" placeholder="00/00/00" maxlength="8">
        </div>
        <div id="msg" class="msg"></div>
      </div>
    </div>

    <div class="footer">
      
      <button id="btn-enviar" type="button">CONFIRMAR</button>
      <button id="btn-cancelar" type="button">CANCELAR</button>

      <button id="btn-confirmar-hoje" type="button" style="display:none;">CONFIRMAR</button>
      <button id="btn-cancelar-hoje" type="button" style="display:none;">CANCELAR</button>
    </div>
  </div>
    `;

    const btnHoje = document.getElementById("btn-hoje");
    const btnAnt = document.getElementById("btn-anteriores");
    
    const boxData = document.getElementById("box-data");
    const inpData = document.getElementById("inp-data");
    const msgEl = document.getElementById("msg");
    const boxHoje = document.getElementById("box-hoje");

    const btnEnviar = document.getElementById("btn-enviar");
    const btnCancelar = document.getElementById("btn-cancelar");
    const btnConfirmarHoje = document.getElementById("btn-confirmar-hoje");
    const btnCancelarHoje = document.getElementById("btn-cancelar-hoje");
  
    function setMsg(t) { if (msgEl) msgEl.textContent = t || ""; }
  
    function closeCancel() {
      window.WlExtension.closeModal({ cancelled: true });
    }
  
    function normalizeDDMMAA(v) {
      let s = String(v || "").replace(/[^\d]/g, "").slice(0, 6);
      if (s.length > 2) s = s.slice(0,2) + "/" + s.slice(2);
      if (s.length > 5) s = s.slice(0,5) + "/" + s.slice(5);
      return s;
    }
  
    function parseDDMMAA(v) {
      const m = String(v || "").trim().match(/^(\d{2})\/(\d{2})\/(\d{2})$/);
      if (!m) return { ok:false, error:"Use 00/00/00 (DD/MM/AA)." };
  
      const dd = Number(m[1]);
      const mm = Number(m[2]);
      const aa = Number(m[3]);
      const yyyy = 2000 + aa;
  
      const d = new Date(yyyy, mm - 1, dd);
      const ok =
        d.getFullYear() === yyyy &&
        d.getMonth() === (mm - 1) &&
        d.getDate() === dd;
  
      if (!ok) return { ok:false, error:"Data inválida." };
  
      return { ok:true, short:`${m[1]}/${m[2]}/${m[3]}`, full:`${m[1]}/${m[2]}/${yyyy}` };
    }
  
    inpData.addEventListener("input", () => {
      inpData.value = normalizeDDMMAA(inpData.value);
      setMsg("");
    });
  
    // alterna o rodapé conforme a tela
    function showFooterForHoje() {
      btnEnviar.style.display = "none";
      btnCancelar.style.display = "none";
      btnConfirmarHoje.style.display = "inline-block";
      btnCancelarHoje.style.display = "inline-block";
    }
  
    function showFooterForData() {
      btnConfirmarHoje.style.display = "none";
      btnCancelarHoje.style.display = "none";
      btnEnviar.style.display = "inline-block";
      btnCancelar.style.display = "inline-block";
    }
  
    btnHoje.onclick = () => {
      boxData.style.display = "none";
      boxHoje.style.display = "block";
      showFooterForHoje();
      setMsg("");
    };
  
    btnAnt.onclick = () => {
      boxHoje.style.display = "none";
      boxData.style.display = "block";
      showFooterForData();
      setTimeout(() => inpData.focus(), 10);
      setMsg("");
    };
  
    btnCancelar.onclick = closeCancel;
    btnCancelarHoje.onclick = closeCancel;
  
    btnConfirmarHoje.onclick = () => {
      window.WlExtension.closeModal({ action: "hoje" });
    };
  
    btnEnviar.onclick = () => {
      const p = parseDDMMAA(inpData.value);
      if (!p.ok) { setMsg(p.error); return; }
  
      window.WlExtension.closeModal({
        action: "anteriores",
        data: p.short,
        dataFull: p.full
      });
    };
  
    btnHoje.click();
}
</script>

</body>
</html>
